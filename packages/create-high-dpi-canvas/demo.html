<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        border: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }

      high-dpi-canvas {
        max-width: calc(100vw - 10vh);
        max-height: 90vh;
        margin: 5vh;
      }
    </style>
  </head>
  <body>
    <script src="dist/create-high-dpi-canvas.standalone.cjs"></script>
    <script>
      function remap(x, a, b, c, d) {
        return c + ((d - c) * (x - a)) / (b - a)
      }

      const canvas = createHighDPICanvas(
        Math.round(window.innerWidth - 0.1 * window.innerHeight),
        Math.round(0.9 * window.innerHeight),
      )

      document.body.appendChild(canvas)

      let frame = 0

      function loop() {
        const context = canvas.getContext("2d")
        context.fillStyle = "rgb(235, 235, 235)"
        context.fillRect(0, 0, canvas.width, canvas.height)

        const blockSize = 32
        const padding = Math.round(0.05 * window.innerHeight)

        const rectWidth =
          Math.round((canvas.width - padding * 2) / blockSize) * blockSize

        const rectHeight =
          Math.round((canvas.height - padding * 2) / blockSize) * blockSize

        const xPadding = (canvas.width - rectWidth) / 2
        const yPadding = (canvas.height - rectHeight) / 2

        context.strokeStyle = "black"
        context.lineWidth = 1

        for (let x = xPadding; x < canvas.width - xPadding; x += blockSize) {
          for (let y = yPadding; y < canvas.height - yPadding; y += blockSize) {
            const hue =
              360 *
              ((x - xPadding) / 1024 + (y - yPadding) / 1024 + frame / 600)

            context.fillStyle = `hsl(${hue}deg, 100%, 50%)`
            context.fillRect(Math.round(x), Math.round(y), blockSize, blockSize)

            context.strokeRect(
              Math.round(x),
              Math.round(y),
              blockSize,
              blockSize,
            )
          }
        }

        frame++

        if (frame > 600) {
          frame = 0
        }

        window.requestAnimationFrame(loop)
      }

      window.addEventListener("resize", () => {
        canvas.dimensions = [
          Math.round(window.innerWidth - 0.1 * window.innerHeight),
          Math.round(0.9 * window.innerHeight),
        ]
      })

      loop()
    </script>
  </body>
</html>
