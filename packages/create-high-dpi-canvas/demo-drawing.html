<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        border: 0;
        width: 100vw;
        height: 100vh;
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <script src="dist/create-high-dpi-canvas.standalone.cjs"></script>
    <script>
      function remap(x, a, b, c, d) {
        return c + ((d - c) * (x - a)) / (b - a)
      }

      let width = window.innerWidth
      let height = window.innerHeight
      const canvas = createHighDPICanvas(width, height)
      document.body.appendChild(canvas)

      let frame = 0

      function loop(shouldRequestAnimationFrame) {
        const context = canvas.getContext("2d")
        context.fillStyle = "rgb(235, 235, 235)"
        context.fillRect(0, 0, width, height)

        const blockSize = 32
        const padding = blockSize * 4

        const rectWidth =
          Math.round((width - padding * 2) / blockSize) * blockSize

        const rectHeight =
          Math.round((height - padding * 2) / blockSize) * blockSize

        const xPadding = (width - rectWidth) / 2
        const yPadding = (height - rectHeight) / 2

        context.strokeStyle = "black"
        context.lineWidth = 2
        context.strokeRect(xPadding, yPadding, rectWidth, rectHeight)

        for (let x = xPadding; x < width - xPadding; x += blockSize) {
          for (let y = yPadding; y < height - yPadding; y += blockSize) {
            const hue =
              360 *
              ((x - xPadding) / 1024 + (y - yPadding) / 1024 + frame / 600)

            context.fillStyle = `hsl(${hue}deg, 100%, 50%)`
            context.fillRect(Math.round(x), Math.round(y), blockSize, blockSize)

            context.strokeRect(
              Math.round(x),
              Math.round(y),
              blockSize,
              blockSize,
            )
          }
        }

        frame++

        if (frame > 600) {
          frame = 0
        }

        if (
          shouldRequestAnimationFrame ||
          typeof shouldRequestAnimationFrame === "undefined"
        ) {
          window.requestAnimationFrame(loop)
        }
      }

      window.addEventListener("resize", () => {
        width = window.innerWidth
        height = window.innerHeight
        canvas.width = width
        canvas.height = height
      })

      canvas.addEventListener("resize", () => loop(false))

      loop()
    </script>
  </body>
</html>
